version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yarn
    build:
      commands: 
        - echo "workspace init"
        - npx dendron workspace init
        - npx dendron workspace pull
        - echo "check"
        - "echo `pwd`"
        - "echo `ls`"
        - "(test -d .next) && (echo 'updating dendron next...' && cd .next && git reset --hard && git clean -f && git pull && yarn && cd ..) || (echo 'init dendron next' && yarn dendron publish init)"
        - yarn dendron publish export
  artifacts:
    baseDirectory: .next/out
    files:
      - '**/*'
  cache:
    paths:
      - kevin-blog/**/*
      - kevin-public/**/*
      - assets/**/*
      - node_modules/**/*
      - .next/node_modules/**/*
      - .next/.git/**/*